
select participant_id,
	sum(case when a.direction = 'BUY' then a.count else 0 end) as buy_count,
	sum(case when a.direction = 'BUY' then a.total else 0 end) as buy_total,
	sum(case when a.direction = 'SELL' then a.count else 0 end) as sell_count,
	sum(case when a.direction = 'SELL' then a.total else 0 end) as sell_total
from(
	select buyer_id as participant_id, 'BUY' as direction, count(*) as count, sum(o.price * quantity) as total
	from lineage.order o
	group by buyer_id, direction
	union all
	select seller_id  as participant_id, 'SELL' as direction, count(*) as count, sum(o.price * quantity) as total
	from lineage.order o
	group by seller_id, direction
) as a
group by a.participant_id

select * from lineage.order where buyer_id = 3 or seller_id = 3
order by buyer_id


select seller_id  as participant_id--, count(*) as count
from lineage.order
group by seller_id

select buyer_id as participant_id, 'BUY' as direction, count(*) as count, lineage.order.price * quantity
from lineage.order as o
group by buyer_id, direction